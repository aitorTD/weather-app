---
import { preprocess } from "astro:schema";
import WeatherCard from "../components/Components.astro";

const { location, weatherData } = await fetchWeatherData();
const key = process.env.WEATHER_API_KEY;
async function fetchWeatherData() {
  const key = process.env.WEATHER_API_KEY;
  console.log(key);
  const response = await fetch(`https://api.weatherapi.com/v1/current.json?key=${key}&q=Cijuela&aqi=no`);
  const data = await response.json();
  return {
    location: data.location.name,
    weatherData: data.current
  };
}

const weatherItems = [
  { label: 'Temperatura', key: 'temp_c', unit: ' °C' },
  { label: 'Sensación Térmica', key: 'feelslike_c', unit: ' °C' },
  { label: 'Humedad', key: 'humidity', unit: ' %' },
  { label: 'Precipitaciones', key: 'precip_mm', unit: ' mm' },
  { label: 'Viento', key: 'wind_kph', unit: ' km/h' },
  { label: 'Presión', key: 'pressure_mb', unit: ' mb' },
  { label: 'Visibilidad', key: 'vis_km', unit: ' km' }
];
---

<div class="weather-app">
  <h2 class="text-3xl font-semibold">Clima en {location}</h2>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8">
    {weatherItems.map(item => (
        <WeatherCard
          title={item.label}
          value={`${weatherData[item.key]} ${item.unit}`}
        />
      ))}
  </div>
</div>